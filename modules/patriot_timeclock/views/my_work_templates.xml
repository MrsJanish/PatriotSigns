<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- My Work Dashboard - Main Template -->
    <template id="my_work_dashboard" name="My Work Dashboard">
        <t t-call="website.layout">
            <t t-set="title">My Work</t>
            <div class="container-fluid my-work-container py-3">
                <!-- Header -->
                <div class="row mb-3">
                    <div class="col-12">
                        <div class="d-flex justify-content-between align-items-center">
                            <h2 class="mb-0">
                                <i class="fa fa-clock-o me-2"/>My Work
                            </h2>
                            <span class="badge bg-secondary fs-6" t-esc="employee.name"/>
                        </div>
                    </div>
                </div>

                <!-- Active Task Card -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div t-if="active_task" class="card border-primary active-task-card">
                            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                                <span class="fw-bold">
                                    <i class="fa fa-play-circle me-2"/>Currently Working
                                </span>
                                <span class="badge bg-light text-dark fs-6 timer-display" 
                                      t-att-data-start="active_task.get('punch_in')">
                                    <t t-esc="active_task.get('duration_display', '0h 0m')"/>
                                </span>
                            </div>
                            <div class="card-body">
                                <h4 class="card-title mb-2" t-esc="active_task.get('task_name', 'Unknown')"/>
                                <p class="card-text text-muted mb-3">
                                    <i class="fa fa-folder-open me-1"/>
                                    <t t-esc="active_task.get('project_name', '')"/>
                                    <t t-if="active_task.get('phase_name')">
                                        <span class="mx-2">â€¢</span>
                                        <span class="badge bg-info" t-esc="active_task.get('phase_name')"/>
                                    </t>
                                </p>
                                <div class="d-flex gap-2 flex-wrap">
                                    <button type="button" 
                                            class="btn btn-success btn-lg flex-grow-1 btn-mark-complete"
                                            t-att-data-task-id="active_task.get('task_id')">
                                        <i class="fa fa-check me-2"/>Mark Complete
                                    </button>
                                    <button type="button" 
                                            class="btn btn-outline-danger btn-lg btn-clock-out">
                                        <i class="fa fa-stop me-2"/>Clock Out
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div t-else="" class="card border-secondary">
                            <div class="card-body text-center py-5">
                                <i class="fa fa-coffee fa-3x text-muted mb-3"/>
                                <h4 class="text-muted">Not Clocked In</h4>
                                <p class="text-muted mb-0">Tap a task below to start working</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="d-flex gap-2">
                            <button type="button" class="btn btn-outline-primary flex-grow-1 btn-scan-qr">
                                <i class="fa fa-qrcode me-2"/>Scan QR Code
                            </button>
                            <button type="button" class="btn btn-outline-secondary btn-refresh">
                                <i class="fa fa-refresh"/>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Work Queue -->
                <div class="row">
                    <div class="col-12">
                        <h5 class="mb-3">
                            <i class="fa fa-list me-2"/>Assigned Tasks
                            <span class="badge bg-secondary" t-esc="len(work_queue)"/>
                        </h5>

                        <t t-if="work_queue">
                            <div class="list-group work-queue-list">
                                <t t-foreach="work_queue" t-as="task">
                                    <a href="#" 
                                       class="list-group-item list-group-item-action task-item py-3"
                                       t-att-data-task-id="task.get('id')"
                                       t-attf-class="list-group-item list-group-item-action task-item py-3 #{task.get('is_active') and 'active' or ''}">
                                        <div class="d-flex w-100 justify-content-between align-items-start">
                                            <div class="flex-grow-1">
                                                <h6 class="mb-1 fw-bold" t-esc="task.get('name')"/>
                                                <p class="mb-1 small text-muted">
                                                    <i class="fa fa-folder-open me-1"/>
                                                    <t t-esc="task.get('project_name')"/>
                                                </p>
                                                <t t-if="task.get('phase_name')">
                                                    <span class="badge" 
                                                          t-attf-style="background-color: var(--phase-color-#{task.get('phase_color', 0)})"
                                                          t-esc="task.get('phase_name')"/>
                                                </t>
                                            </div>
                                            <div class="text-end">
                                                <t t-if="task.get('is_active')">
                                                    <span class="badge bg-success">
                                                        <i class="fa fa-play"/> Active
                                                    </span>
                                                </t>
                                                <t t-else="">
                                                    <span class="badge bg-light text-dark">
                                                        <i class="fa fa-hand-pointer-o"/> Tap to Start
                                                    </span>
                                                </t>
                                                <t t-if="task.get('estimated_hours')">
                                                    <div class="small text-muted mt-1">
                                                        Est: <t t-esc="'%.1f' % task.get('estimated_hours')"/>h
                                                    </div>
                                                </t>
                                            </div>
                                        </div>
                                    </a>
                                </t>
                            </div>
                        </t>

                        <t t-else="">
                            <div class="card border-secondary">
                                <div class="card-body text-center py-5">
                                    <i class="fa fa-inbox fa-3x text-muted mb-3"/>
                                    <h5 class="text-muted">No Tasks Assigned</h5>
                                    <p class="text-muted mb-0">Talk to your manager to get work assigned</p>
                                </div>
                            </div>
                        </t>
                    </div>
                </div>

                <!-- QR Scanner Modal -->
                <div class="modal fade" id="qrScannerModal" tabindex="-1">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Scan Task QR Code</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"/>
                            </div>
                            <div class="modal-body">
                                <div id="qr-reader" style="width: 100%"></div>
                                <div id="qr-reader-results" class="mt-3 text-center"/>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Loading Overlay -->
                <div class="loading-overlay d-none">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>
        </t>
    </template>

    <!-- No Employee Template -->
    <template id="my_work_no_employee" name="My Work - No Employee">
        <t t-call="website.layout">
            <t t-set="title">My Work</t>
            <div class="container py-5">
                <div class="row justify-content-center">
                    <div class="col-md-6">
                        <div class="card border-warning">
                            <div class="card-body text-center py-5">
                                <i class="fa fa-exclamation-triangle fa-3x text-warning mb-3"/>
                                <h4>No Employee Record</h4>
                                <p class="text-muted">
                                    Your user account is not linked to an employee record.
                                    Please contact your administrator.
                                </p>
                                <a href="/web" class="btn btn-primary">
                                    <i class="fa fa-arrow-left me-2"/>Back to Odoo
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
</odoo>
